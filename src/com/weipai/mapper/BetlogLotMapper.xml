<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.weipai.mapper.BetlogLotMapper" >
  <resultMap id="betlogLotResult" type="com.weipai.model.BetlogLot" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <id column="id" property="id" jdbcType="INTEGER" />
    <result column="uuid" property="uuid" jdbcType="INTEGER" />
    <result column="serialNum" property="serialnum" jdbcType="INTEGER" />
    <result column="lotId" property="lotid" jdbcType="INTEGER" />
    <result column="betType" property="bettype" jdbcType="INTEGER" />
    <result column="betMount" property="betmount" jdbcType="INTEGER" />
    <result column="betResult" property="betresult" jdbcType="INTEGER" />
    <result column="createTime" property="createtime" jdbcType="TIMESTAMP" />
    <result column="lotResult" property="lotResult" jdbcType="VARCHAR" />
    <result column="facevalue" property="facevalue" jdbcType="VARCHAR" />
    <result column="cardcount" property="cardcount" jdbcType="VARCHAR" />
  </resultMap>
  
  <sql id="Base_Column_List" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    id, uuid, serialNum, lotId, betType, betMount, betResult,createTime,lotResult,facevalue,cardcount
  </sql>
  
  <select id="selectByPrimaryKey" resultMap="betlogLotResult" parameterType="java.lang.Integer" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select 
    <include refid="Base_Column_List" />
    from betlog_lot
    where id = #{id,jdbcType=INTEGER}
  </select>
  
  <select id="selectExistCurUuidBets" resultMap="betlogLotResult" parameterType="Map" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select 
    <include refid="Base_Column_List" />
    from betlog_lot
    where 1=1
    <if test="lotId != null" >
      and lotId = #{lotId,jdbcType=INTEGER} 
      </if>
      <if test="lotId == null" >
       and lotId =  0 
      </if>
      <if test="uuid != null" >
      and uuid = #{uuid,jdbcType=INTEGER}
      </if>
      <if test="serialNum != null" >
      and serialNum = #{serialNum,jdbcType=INTEGER} 
      </if>
      <if test="betType != null" >
      and betType = #{betType,jdbcType=INTEGER} 
      </if>
  </select>
  
  <select id="getRecentBetlogLotWinner" resultMap="betlogLotResult"  parameterType="Map">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select a.id, a.uuid, a.serialNum, a.lotId, a.betType, a.betMount, a.betResult,a.createTime,b.nickName as lotResult,a.facevalue,a.cardcount  from betlog_lot a , account b where a.uuid = b.Uuid
    and a.betResult = 1 and a.serialNum = #{serialNum,jdbcType=INTEGER} order by a.id DESC limit #{startNum,jdbcType=INTEGER},#{pageNumber,jdbcType=INTEGER};
  </select>
  
  <select id="getRecentBetlogLot" resultMap="betlogLotResult"  parameterType="Map">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select 
    <include refid="Base_Column_List" />
    from betlog_lot
    where 1=1
    <if test="lotId != null" >
      and lotId = #{lotId,jdbcType=INTEGER} 
      </if>
      <if test="lotId == null" >
       and lotId =  0 
      </if>
      <if test="uuid != null" >
      and uuid = #{uuid,jdbcType=INTEGER}
      </if>
      <if test="betResult != null" >
      and betResult = #{betResult,jdbcType=INTEGER}
      </if>
      <if test="serialNum != null" >
      and serialNum = #{serialNum,jdbcType=INTEGER} 
      </if>
      order by serialNum desc limit #{startNum,jdbcType=INTEGER},#{pageNumber,jdbcType=INTEGER}
  </select>
  
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    delete from betlog_lot
    where id = #{id,jdbcType=INTEGER}
  </delete>
  
  <update id="openLot" parameterType="map" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update betlog_lot set betResult = 1,lotResult = #{lotResult,jdbcType=VARCHAR} 
    where lotId = #{lotId,jdbcType=INTEGER} 
    and serialNum = #{serialNum,jdbcType=INTEGER}
    and (betType = #{type1,jdbcType=INTEGER} or betType = #{type2,jdbcType=INTEGER} or betType = #{type3,jdbcType=INTEGER} or betType = #{type4,jdbcType=INTEGER} or betType = #{type5,jdbcType=INTEGER} or betType = #{type6,jdbcType=INTEGER});
    
    update betlog_lot set betResult = 0,lotResult = #{lotResult,jdbcType=VARCHAR}
    where lotId = #{lotId,jdbcType=INTEGER} 
    and serialNum = #{serialNum,jdbcType=INTEGER}
    and (betType != #{type1,jdbcType=INTEGER} and betType != #{type2,jdbcType=INTEGER} and betType != #{type3,jdbcType=INTEGER} and betType != #{type4,jdbcType=INTEGER} and betType != #{type5,jdbcType=INTEGER} and betType != #{type6,jdbcType=INTEGER});
    
    update account a, betlog_lot b set a.redCard = (IFNULL(a.redCard,0)+b.betMount/11*20) where 
    a.uuid = b.uuid 
    and b.lotId = #{lotId,jdbcType=INTEGER} 
    and (b.betType = #{type1,jdbcType=INTEGER}) 
    and b.serialNum = #{serialNum,jdbcType=INTEGER};
    
    update account a, betlog_lot b set a.redCard = (IFNULL(a.redCard,0)+b.betMount/11*20) where 
    a.uuid = b.uuid 
    and b.lotId = #{lotId,jdbcType=INTEGER} 
    and (b.betType = #{type2,jdbcType=INTEGER}) 
    and b.serialNum = #{serialNum,jdbcType=INTEGER};
    
    update account a, betlog_lot b set a.redCard = (IFNULL(a.redCard,0)+b.betMount/7*25) where 
    a.uuid = b.uuid 
    and b.lotId = #{lotId,jdbcType=INTEGER} 
    and (b.betType = #{type3,jdbcType=INTEGER}) 
    and b.serialNum = #{serialNum,jdbcType=INTEGER};
    
    update account a, betlog_lot b set a.redCard = (IFNULL(a.redCard,0)+b.betMount/11*100) where 
    a.uuid = b.uuid 
    and b.lotId = #{lotId,jdbcType=INTEGER} 
    and (b.betType = #{type4,jdbcType=INTEGER}) 
    and b.serialNum = #{serialNum,jdbcType=INTEGER};
    
    update account a, betlog_lot b set a.redCard = (IFNULL(a.redCard,0)+b.betMount/11*100) where 
    a.uuid = b.uuid 
    and b.lotId = #{lotId,jdbcType=INTEGER} 
    and (b.betType = #{type5,jdbcType=INTEGER}) 
    and b.serialNum = #{serialNum,jdbcType=INTEGER};
    
    update account a, betlog_lot b set a.redCard = (IFNULL(a.redCard,0)+b.betMount/11*100) where 
    a.uuid = b.uuid 
    and b.lotId = #{lotId,jdbcType=INTEGER} 
    and (b.betType = #{type6,jdbcType=INTEGER}) 
    and b.serialNum = #{serialNum,jdbcType=INTEGER};
  </update>
  
  <insert id="insert" parameterType="com.weipai.model.BetlogLot" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into betlog_lot (id, uuid, serialNum, 
      lotId, betType, betMount, 
      betResult,createTime,lotResult,facevalue,cardcount)
    values (#{id,jdbcType=INTEGER}, #{uuid,jdbcType=INTEGER}, #{serialnum,jdbcType=INTEGER}, 
      #{lotid,jdbcType=INTEGER}, #{bettype,jdbcType=INTEGER}, #{betmount,jdbcType=INTEGER}, 
      #{betresult,jdbcType=INTEGER}, #{createtime,jdbcType=INTEGER}, #{lotResult,jdbcType=INTEGER},#{facevalue,jdbcType=VARCHAR},#{cardcount,jdbcType=VARCHAR})
  </insert>
  <update id="minu4insertSelective" parameterType="map" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update account  set redCard = (redCard-#{amount,jdbcType=INTEGER}) where 
    uuid = #{uuid,jdbcType=INTEGER} and redCard >= #{amount,jdbcType=INTEGER}

  </update>
  <insert id="insertSelective" parameterType="com.weipai.model.BetlogLot" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into betlog_lot
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        id,
      </if>
      <if test="uuid != null" >
        uuid,
      </if>
      <if test="serialnum != null" >
        serialNum,
      </if>
      <if test="lotid != null" >
        lotId,
      </if>
      <if test="bettype != null" >
        betType,
      </if>
      <if test="betmount != null" >
        betMount,
      </if>
      <if test="betresult != null" >
        betResult,
      </if>
      <if test="createtime != null" >
        createTime,
      </if>
      <if test="lotResult != null" >
        lotResult,
      </if>
      <if test="facevalue != null" >
        facevalue,
      </if>
      <if test="cardcount != null" >
        cardcount,
      </if>
      <if test="uuid != null" >
      	managerId,
      	</if>
    </trim>
    <trim prefix=" (" suffix=")" suffixOverrides="," >
    	select 
      <if test="id != null" >
        #{id,jdbcType=INTEGER},
      </if>
      <if test="uuid != null" >
        #{uuid,jdbcType=INTEGER},
      </if>
      <if test="serialnum != null" >
        #{serialnum,jdbcType=INTEGER},
      </if>
      <if test="lotid != null" >
        #{lotid,jdbcType=INTEGER},
      </if>
      <if test="bettype != null" >
        #{bettype,jdbcType=INTEGER},
      </if>
      <if test="betmount != null" >
        #{betmount,jdbcType=INTEGER},
      </if>
      <if test="betresult != null" >
        #{betresult,jdbcType=INTEGER},
      </if>
      <if test="createtime != null" >
        #{createtime,jdbcType=TIMESTAMP},
      </if>
      <if test="lotResult != null" >
        #{lotResult,jdbcType=VARCHAR},
      </if>
      <if test="facevalue != null" >
        #{facevalue,jdbcType=VARCHAR},
      </if>
      <if test="cardcount != null" >
        #{cardcount,jdbcType=VARCHAR},
      </if>
      <if test="uuid != null" >
      (IFNULL((select manager_up_id from account where Uuid = #{uuid,jdbcType=INTEGER}),null))
      </if>
       <if test="serialnum != null" >
      from dual where (select MAX(serialNum)+1 from result_lot) = #{serialnum,jdbcType=INTEGER},
      </if>
    </trim>
  </insert>
 
  <update id="updateByPrimaryKeySelective" parameterType="com.weipai.model.BetlogLot" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update betlog_lot
    <set >
      <if test="uuid != null" >
        uuid = #{uuid,jdbcType=INTEGER},
      </if>
      <if test="serialnum != null" >
        serialNum = #{serialnum,jdbcType=INTEGER},
      </if>
      <if test="lotid != null" >
        lotId = #{lotid,jdbcType=INTEGER},
      </if>
      <if test="bettype != null" >
        betType = #{bettype,jdbcType=INTEGER},
      </if>
      <if test="betmount != null" >
        betMount = #{betmount,jdbcType=INTEGER},
      </if>
      <if test="betresult != null" >
        betResult = #{betresult,jdbcType=INTEGER},
      </if>
      <if test="createtime != null" >
        createTime = #{createtime,jdbcType=TIMESTAMP},
      </if>
      <if test="lotResult != null" >
        lotResult = #{lotResult,jdbcType=VARCHAR},
      </if>
      <if test="facevalue != null" >
        facevalue = #{facevalue,jdbcType=VARCHAR},
      </if>
      <if test="cardcount != null" >
        cardcount = #{cardcount,jdbcType=VARCHAR},
      </if>
    </set>
    where id = #{id,jdbcType=INTEGER}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.weipai.model.BetlogLot" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update betlog_lot
    set uuid = #{uuid,jdbcType=INTEGER},
      serialNum = #{serialnum,jdbcType=INTEGER},
      lotId = #{lotid,jdbcType=INTEGER},
      betType = #{bettype,jdbcType=INTEGER},
      betMount = #{betmount,jdbcType=INTEGER},
      betResult = #{betresult,jdbcType=INTEGER},
      createTime = #{createtime,jdbcType=TIMESTAMP},
      lotResult = #{lotResult,jdbcType=VARCHAR},
      facevalue = #{facevalue,jdbcType=VARCHAR},
      cardcount = #{cardcount,jdbcType=VARCHAR}
    where id = #{id,jdbcType=INTEGER}
  </update>
</mapper>